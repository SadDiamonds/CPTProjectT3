{% extends "layout.html" %}
{% block title %}Your Matches{% endblock %}

{% block content %}
<div id="swup" class="transition-fade">
  <main>
    <h1>Donations</h1>
    <div class="container">
      {% for match in matches %}
        <div class="card" style="max-width: 30rem">
          <img src="{{ url_for('static', filename=match.image_url or 'placeholder.png') }}" class="card-image" alt="Donation Image">
          <div class="card-body">
            <h3>{{ match.items }}</h3>
            <p><strong>Category:</strong> {{ match.category }}</p>
            <p><strong>Status:</strong> {{ match.status }}</p>

            {% if user.role == "Donor" %}
              <p><strong>Requested by:</strong> {{ match.recipient_name }}</p>
              {% if match.status == "Pending" %}
                <form action="{{ url_for('update_match_status', match_id=match.match_id, status='Accepted') }}" method="POST">
                  <button class="btn success" type="submit">Accept</button>
                </form>
                <form action="{{ url_for('update_match_status', match_id=match.match_id, status='Rejected') }}" method="POST">
                  <button class="btn danger" type="submit">Reject</button>
                </form>
              {% elif match.status == "Accepted" and not match.donor_completed %}
                <form action="{{ url_for('complete_match', match_id=match.match_id) }}" method="POST">
                  <button class="btn success" type="submit">Mark as Completed</button>
                </form>
              {% endif %}
            {% else %}
              <p><strong>Donor:</strong> {{ match.donor_name }}</p>
              {% if match.status == "Accepted" and not match.recipient_completed %}
                <form action="{{ url_for('complete_match', match_id=match.match_id) }}" method="POST">
                  <button class="btn success" type="submit">Mark as Completed</button>
                </form>
              {% endif %}
            {% endif %}
          </div>
        </div>
      {% else %}
        <p style="font-style:italic">No donations found.</p>
      {% endfor %}
    </div>
  </main>
</div>
{% endblock %}
